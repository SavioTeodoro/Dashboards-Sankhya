<gadget>
  <prompt-parameters>
    <parameter id="ANO" description="ANO " metadata="text" required="true" keep-last="true" keep-date="false"/>
    <parameter id="CODEMP" description="Empresa" metadata="multiList:Text" listType="sql" required="true" keep-last="true" keep-date="false">
      <expression type="SQL"><![CDATA[SELECT CODEMP AS VALUE,
CODEMP||'-'||RAZAOSOCIAL AS LABEL FROM TSIEMP 
ORDER BY 1]]></expression>
    </parameter>
    <parameter id="MES" description="Meses para compor um acumulado:" metadata="multiList:Text" listType="text" required="true" keep-last="true" keep-date="false" order="6">
      <item value="01" label="01-Janeiro"/>
      <item value="02" label="02-Fevereiro"/>
      <item value="03" label="03-Março"/>
      <item value="04" label="04-Abril"/>
      <item value="05" label="05-Maio"/>
      <item value="06" label="06-Junho"/>
      <item value="07" label="07-Julho"/>
      <item value="08" label="08-Agosto"/>
      <item value="09" label="09-Setembro"/>
      <item value="10" label="10-Outubro"/>
      <item value="11" label="11-Novembro"/>
      <item value="12" label="12-Dezembro"/>
    </parameter>
  </prompt-parameters>
  <local-vars>
    <var id="IMPRIME">
      <expression type="sql" data-source="MGEDS"><![CDATA[SELECT 'S' AS IMPRIME FROM DUAL]]></expression>
    </var>
  </local-vars>
  <level id="lvl_aiomzfq" description="Principal">
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="H" tamanhoRelativo="176">
        <container orientacao="V" tamanhoRelativo="180">
          <simple-value id="svl_n0wifr">
            <value-expression><![CDATA[<div style='text-align: right;'></div><div style='text-align: right;'><span style='font-family: Verdana, Geneva, sans-serif; font-size: 18px;'><b>ANÁLISE DE RESULTADOS </b></span></div>   <br>]]></value-expression>
          </simple-value>
        </container>
        <container orientacao="V" tamanhoRelativo="126">
          <simple-value id="svl_n0wifs">
            <value-expression><![CDATA[<span style='color: #0000FF;'><div style='text-align: right;'>Abrir Ativo/Passivo</div></span>]]></value-expression>
            <on-click navigate-to="lvl_aa6aaqo"/>
          </simple-value>
        </container>
      </container>
      <container orientacao="V" tamanhoRelativo="1504">
        <grid id="grd_n0wift" useNewGrid="S">
          <expression type="sql" data-source="MGEDS"><![CDATA[  SELECT
 ORDEM, 
CODCTACTB, 
CTACTB,
DESCRCTA,
 NVL(SUM(MES01),0) AS JAN,
NVL(SUM(MES02),0) AS FEV,
NVL(SUM(MES03),0) AS MAR,
NVL(SUM(MES04),0) AS ABR,
NVL(SUM(MES05),0) AS MAI,
NVL(SUM(MES06),0) AS JUN,
NVL(SUM(MES07),0) AS JUL,
NVL(SUM(MES08),0) AS AGO,
NVL(SUM(MES09),0) AS SETE,
NVL(SUM(MES10),0) AS OUTU,
NVL(SUM(MES11),0) AS NOV,
NVL(SUM(MES12),0) AS DEZ,
NVL(SUM(TOTAL),0) AS TOTAL, 

CASE WHEN GRAU = 0 THEN '#4169E1' 
 WHEN GRAU = 1 THEN '#1E90FF'
 WHEN GRAU = 2 THEN '#00BFFF'
 WHEN GRAU = 3 THEN '#87CEFA'
 WHEN GRAU = 4 THEN '#87CEEB'
 WHEN GRAU = 5 THEN '#87deeb'

END AS BKCOLOR,
CASE WHEN GRAU > 5 THEN '#000000' 
WHEN GRAU <= 5 THEN '#FFFFFF' 
END AS FGCOLOR
FROM (


SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, CASE WHEN SUBSTR (PLA.CTACTB,1,1) = '3' THEN 999 END AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL, */
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,1) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,1) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
 
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
/* NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,3) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,3) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
 
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,5) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,5) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
 
GROUP BY PLA.CODCTACTB,PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL 
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,8) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,8) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
UNION ALL

SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,11) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,11) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
   
UNION ALL

SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,17) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,17) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
    


)C
 WHERE SUBSTR(CTACTB,1,1)=3 OR SUBSTR(CTACTB,1,1)=4 OR SUBSTR(CTACTB,1,1)=5
 AND NVL(TOTAL,0) <>0 

 
GROUP BY ORDEM, GRAU,CTACTB,CODCTACTB, DESCRCTA

 ORDER BY CTACTB]]></expression>
          <metadata>
            <field name="ORDEM" label="ORDEM" type="F" visible="false" useFooter="false"/>
            <field name="CODCTACTB" label="Cta. Reduz" type="I" visible="true" useFooter="false"/>
            <field name="CTACTB" label="Conta Contabil" type="S" visible="true" useFooter="false"/>
            <field name="DESCRCTA" label="Descrição" type="S" visible="true" useFooter="false"/>
            <field name="JAN" label="Janeiro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="FEV" label="Fevereiro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="MAR" label="Março" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="ABR" label="Abril" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="MAI" label="Maio" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="JUN" label="Junho" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="JUL" label="Julho" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="AGO" label="Agosto" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="SETE" label="Setembro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="OUTU" label="Outubro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="NOV" label="Novembro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="DEZ" label="Dezembro" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="TOTAL" label="Total Geral" type="F" visible="true" useFooter="null" mask="#.##0,00;-n"/>
            <field name="BKCOLOR" label="BKCOLOR" type="S" visible="false" useFooter="false"/>
            <field name="FGCOLOR" label="FGCOLOR" type="S" visible="false" useFooter="false"/>
          </metadata>
          <on-click navigate-to="lvl_acmi6ma">
            <param id="CTA">$CTACTB</param>
          </on-click>
        </grid>
      </container>
    </container>
  </level>
  <level id="lvl_acmi6ma" description="Plano Analitico">
    <args>
      <arg id="CTA" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="100">
        <simple-value id="svl_acmi6mc">
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECT DESCRCTA FROM TCBPLA WHERE CTACTB = :CTA]]></expression>
          <metadata>
            <field name="DESCRCTA" label="DESCRCTA" type="S" visible="true" useFooter="false"/>
          </metadata>
          <value-expression><![CDATA[<b><span style='color: #0000FF; font-size: 16px;'><div style='text-align: center;'>MOVIMENTOS DA CONTA :CTA - $DESCRCTA  </div></span></b>]]></value-expression>
        </simple-value>
      </container>
      <container orientacao="V" tamanhoRelativo="780">
        <grid id="grd_acmi6mb" multiplaSelecao="S" useNewGrid="S">
          <expression type="sql" data-source="MGEDS"><![CDATA[    
SELECT
 ORDEM, 
CODCTACTB, 
CTACTB,
DESCRCTA,
 NVL(SUM(MES01)* 1,0) AS JAN,
NVL(SUM(MES02)* 1,0) AS FEV,
NVL(SUM(MES03)* 1,0) AS MAR,
NVL(SUM(MES04)* 1,0) AS ABR,
NVL(SUM(MES05)* 1,0) AS MAI,
NVL(SUM(MES06)* 1,0) AS JUN,
NVL(SUM(MES07)* 1,0) AS JUL,
NVL(SUM(MES08)* 1,0) AS AGO,
NVL(SUM(MES09)* 1,0) AS SETE,
NVL(SUM(MES10)* 1,0) AS OUTU,
NVL(SUM(MES11)* 1,0) AS NOV,
NVL(SUM(MES12)* 1,0) AS DEZ,
NVL(SUM(TOTAL)* 1,0) AS TOTAL, 

CASE WHEN GRAU = 0 THEN '#4169E1' 
 WHEN GRAU = 1 THEN '#1E90FF'
 WHEN GRAU = 2 THEN '#00BFFF'
 WHEN GRAU = 3 THEN '#87CEFA'
 WHEN GRAU = 4 THEN '#87CEEB'
 WHEN GRAU = 5 THEN '#ADD8E6'
 WHEN GRAU = 6 THEN '#4682B4'

END AS BKCOLOR,
CASE WHEN GRAU <> 7 THEN '#FFFFFF' 
END AS FGCOLOR
FROM (
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 

INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,17) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND SUBSTR (PLA.CTACTB,1,17)  = :CTA 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000 
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
  
 


)C
 WHERE  
  NVL(TOTAL,0) <>0
 
 
GROUP BY ORDEM, GRAU,CTACTB,CODCTACTB, DESCRCTA

 ORDER BY CTACTB]]></expression>
          <metadata>
            <field name="ORDEM" label="ORDEM" type="F" visible="false" useFooter="false"/>
            <field name="CODCTACTB" label="Cta. Reduz" type="I" visible="true" useFooter="false"/>
            <field name="CTACTB" label="Conta Contabil" type="S" visible="true" useFooter="false"/>
            <field name="DESCRCTA" label="Descrição" type="S" visible="true" useFooter="false"/>
            <field name="JAN" label="Janeiro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="FEV" label="Fevereiro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="MAR" label="Março" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="ABR" label="Abril" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="MAI" label="Maio" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="JUN" label="Junho" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="JUL" label="Julho" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="AGO" label="Agosto" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="SETE" label="Setembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="OUTU" label="Outubro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="NOV" label="Novembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="DEZ" label="Dezembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
            <field name="TOTAL" label="Total Geral" type="F" visible="true" useFooter="true" mask="#.##0,00"/>
            <field name="BKCOLOR" label="BKCOLOR" type="S" visible="false" useFooter="false"/>
            <field name="FGCOLOR" label="FGCOLOR" type="S" visible="false" useFooter="false"/>
          </metadata>
          <on-click navigate-to="lvl_409tbz">
            <param id="CTA">$CTACTB</param>
          </on-click>
        </grid>
      </container>
    </container>
  </level>
  <level id="lvl_aa6aaqo" description="Ativo/Passivo">
    <container orientacao="V" tamanhoRelativo="100">
      <grid id="grd_aa6aaqr" useNewGrid="S">
        <expression type="sql" data-source="MGEDS"><![CDATA[  SELECT
 ORDEM, 
CODCTACTB, 
CTACTB,
DESCRCTA,
 NVL(SUM(MES01),0) AS JAN,
NVL(SUM(MES02),0) AS FEV,
NVL(SUM(MES03),0) AS MAR,
NVL(SUM(MES04),0) AS ABR,
NVL(SUM(MES05),0) AS MAI,
NVL(SUM(MES06),0) AS JUN,
NVL(SUM(MES07),0) AS JUL,
NVL(SUM(MES08),0) AS AGO,
NVL(SUM(MES09),0) AS SETE,
NVL(SUM(MES10),0) AS OUTU,
NVL(SUM(MES11),0) AS NOV,
NVL(SUM(MES12),0) AS DEZ,
NVL(SUM(TOTAL),0) AS TOTAL, 

CASE WHEN GRAU = 0 THEN '#4169E1' 
 WHEN GRAU = 1 THEN '#1E90FF'
 WHEN GRAU = 2 THEN '#00BFFF'
 WHEN GRAU = 3 THEN '#87CEFA'
 WHEN GRAU = 4 THEN '#87CEEB'
 WHEN GRAU = 5 THEN '#ADD8E6'
END AS BKCOLOR,
CASE WHEN GRAU <> 6 THEN '#FFFFFF' 
END AS FGCOLOR
FROM (


SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, CASE WHEN SUBSTR (PLA.CTACTB,1,1) = '3' THEN 999 END AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL, */
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,1) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,1) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
 
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
/* NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,3) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,3) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
 
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL
 
FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,5) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,5) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
 
GROUP BY PLA.CODCTACTB,PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
 UNION ALL 
 
 
SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,7) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,7) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
 
UNION ALL

SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,10) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,10) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS
   
UNION ALL

SELECT PLA.CODCTACTB,LAN.CODCENCUS,(SELECT DESCRCENCUS FROM TSICUS WHERE CODCENCUS = LAN.CODCENCUS)DESCRCENCUS, PLA.CTACTB, PLA.DESCRCTA,PLA.GRAU, NULL AS ORDEM,
 (CASE WHEN LAN.REFERENCIA =  '01/01/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES01,
 (CASE WHEN LAN.REFERENCIA =  '01/02/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES02,
 (CASE WHEN LAN.REFERENCIA =  '01/03/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES03,
 (CASE WHEN LAN.REFERENCIA =  '01/04/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES04, 
 (CASE WHEN LAN.REFERENCIA =  '01/05/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES05, 
 (CASE WHEN LAN.REFERENCIA =  '01/06/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES06,
 (CASE WHEN LAN.REFERENCIA =  '01/07/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES07, 
 (CASE WHEN LAN.REFERENCIA =  '01/08/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES08, 
 (CASE WHEN LAN.REFERENCIA =  '01/09/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES09,
 (CASE WHEN LAN.REFERENCIA =  '01/10/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES10, 
 (CASE WHEN LAN.REFERENCIA =  '01/11/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES11,
 (CASE WHEN LAN.REFERENCIA =  '01/12/'|| :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS MES12,
 /*NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) AS TOTAL,*/ 
 (CASE WHEN TO_CHAR(LAN.REFERENCIA,'MM') IN :MES AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO THEN NVL( SUM(CASE WHEN LAN.TIPLANC = 'D' THEN  -LAN.VLRLANC ELSE LAN.VLRLANC END)  * -1,0) END) AS TOTAL 

 

FROM TSIEMP EMP 
INNER JOIN TCBEMP EMPC ON EMPC.CODEMP= EMP.CODEMP
INNER JOIN TCBPLA PLA ON PLA.CODEMP = EMPC.CODEMPPLACTA 
INNER JOIN TCBLAN LAN ON LAN.CODEMP = EMP.CODEMP AND LAN.CODCTACTB IN(SELECT CODCTACTB FROM TCBPLA PL WHERE SUBSTR(PL.CTACTB,1,16) =PLA.CTACTB AND PL.CODEMP = PLA.CODEMP ) 
WHERE EMP.CODEMP IN :CODEMP
AND PLA.CTACTB = SUBSTR (PLA.CTACTB,1,16) 
AND TO_CHAR(LAN.REFERENCIA,'YYYY') = :ANO
AND LAN.NUMLOTE <> 6000
  
GROUP BY PLA.CODCTACTB, PLA.CTACTB,PLA.DESCRCTA,PLA.GRAU, LAN.REFERENCIA,LAN.CODCENCUS



)C
 WHERE SUBSTR(CTACTB,1,1)=1 OR SUBSTR(CTACTB,1,1)=2
 AND NVL(TOTAL,0) <>0 

 
GROUP BY ORDEM, GRAU,CTACTB,CODCTACTB, DESCRCTA

 ORDER BY CTACTB]]></expression>
        <metadata>
          <field name="ORDEM" label="ORDEM" type="F" visible="false" useFooter="false"/>
          <field name="CODCTACTB" label="Cta. Reduz" type="I" visible="true" useFooter="false"/>
          <field name="CTACTB" label="Conta Contabil" type="S" visible="true" useFooter="false"/>
          <field name="DESCRCTA" label="Descrição" type="S" visible="true" useFooter="false"/>
          <field name="JAN" label="Janeiro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="FEV" label="Fevereiro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="MAR" label="Março" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="ABR" label="Abril" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="MAI" label="Maio" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="JUN" label="Junho" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="JUL" label="Julho" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="AGO" label="Agosto" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="SETE" label="Setembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="OUTU" label="Outubro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="NOV" label="Novembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="DEZ" label="Dezembro" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="TOTAL" label="Total Geral" type="F" visible="true" useFooter="true" mask="#.##0,00;-n"/>
          <field name="BKCOLOR" label="BKCOLOR" type="S" visible="false" useFooter="false"/>
          <field name="FGCOLOR" label="FGCOLOR" type="S" visible="false" useFooter="false"/>
        </metadata>
        <on-click navigate-to="lvl_409tbz">
          <param id="CTA">$CTACTB</param>
        </on-click>
      </grid>
    </container>
  </level>
  <level id="lvl_409tbz" description="Nivel2">
    <args>
      <arg id="CTA" type="text"/>
    </args>
    <container orientacao="V" tamanhoRelativo="100">
      <container orientacao="V" tamanhoRelativo="100">
        <simple-value id="svl_5azv51">
          <args>
            <arg id="DT" type="date"/>
            <arg id="CT" type="text"/>
          </args>
          <expression type="sql" data-source="MGEDS"><![CDATA[SELECT DESCRCTA FROM TCBPLA WHERE CTACTB= :CTA
]]></expression>
          <metadata>
            <field name="DESCRCTA" label="DESCRCTA" type="S" visible="true" useFooter="false"/>
          </metadata>
          <value-expression><![CDATA[<b><span style='color: #0000FF; font-size: 16px;'><div style='text-align: center;'>MOVIMENTOS DA CONTA :CTA - $DESCRCTA  </div></span></b>]]></value-expression>
        </simple-value>
      </container>
      <container orientacao="H" tamanhoRelativo="1127">
        <container orientacao="V" tamanhoRelativo="114">
          <grid id="grd_5azv5z">
            <expression type="sql" data-source="MGEDS"><![CDATA[SELECT   '01/01/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/02/'|| :ANO AS REFERENCIA ,:CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/03/'|| :ANO AS REFERENCIA ,:CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/04/'|| :ANO AS REFERENCIA, :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/05/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/06/'|| :ANO AS REFERENCIA ,:CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/07/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/08/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/09/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL  
UNION ALL
SELECT   '01/10/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/11/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
UNION ALL
SELECT   '01/12/'|| :ANO AS REFERENCIA , :CTA AS CONTA FROM  DUAL 
ORDER BY 1]]></expression>
            <metadata>
              <field name="REFERENCIA" label="REFERENCIA" type="D" visible="true" useFooter="false"/>
              <field name="CONTA" label="CONTA" type="S" visible="true" useFooter="false"/>
            </metadata>
            <refresh-details ui-list="svl_5azv51,svl_9g4axo,grd_5azv50">
              <param id="DT">$REFERENCIA</param>
              <param id="CT">$CONTA</param>
            </refresh-details>
          </grid>
        </container>
        <container orientacao="V" tamanhoRelativo="438">
          <container orientacao="V" tamanhoRelativo="122">
            <simple-value id="svl_9g4axo">
              <args>
                <arg id="DT" type="date"/>
                <arg id="CT" type="text"/>
              </args>
              <expression type="sql" data-source="MGEDS"><![CDATA[
 SELECT

(SELECT  
CASE   WHEN  (   TO_CHAR(:DT,'MM') = 01  AND SUBSTR(:CT,1,1) = 3 ) THEN 0 
WHEN :IMPRIME = 'S' THEN 0 
ELSE   
 (SUM( SALDOINICMES + DEBMES - CREDMES) ) * (CASE WHEN SUBSTR(:CT,1,1) = 3 THEN -1 ELSE 1 END )
END 
  FROM TCBSAL SAL
  WHERE CODEMP IN :CODEMP
  AND  SAL.CODCTACTB IN (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
  AND SAL.REFERENCIA = ADD_MONTHS(:DT,-1)   
) AS SALDOANT,

/*
(SELECT CASE WHEN :IMPRIME = 'S' THEN 0 
    WHEN CAST ( DATEADD(MM, -1, :DT) AS VARCHAR) ='01' THEN 0 
    ELSE (SUM(CASE WHEN  LAN.TIPLANC = 'R' THEN VLRLANC WHEN LAN.TIPLANC= 'D' THEN   LAN.VLRLANC *-1 END ))*
    (CASE WHEN SUBSTR(:CT,1,1) = 3 THEN -1 ELSE 1 END )
    END 
 FROM
  TCBLAN LAN  
WHERE 
LIBERADO = 'S'
AND LAN.CODEMP IN :CODEMP
AND LAN.CODCTACTB IN   (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
AND REFERENCIA = DATEADD(MM, -1, :DT)  
)   AS SALDOANT,  */


 ( SELECT 
ABS (SUM(CASE WHEN  LAN.TIPLANC = 'R' THEN VLRLANC  END )) 
 FROM
  TCBLAN LAN  
WHERE 
LIBERADO = 'S'
AND LAN.CODEMP IN :CODEMP
AND LAN.CODCTACTB IN   (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
AND LAN.REFERENCIA= :DT
) CREDITO,

( SELECT 
 ABS(SUM(CASE  WHEN LAN.TIPLANC= 'D' THEN   LAN.VLRLANC *-1   END )) 
 FROM
  TCBLAN LAN  
WHERE 
LIBERADO = 'S'
AND LAN.CODEMP IN :CODEMP
AND LAN.CODCTACTB IN   (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
AND LAN.REFERENCIA= :DT
) DEBITO,


/*------soma--------*/
(SELECT  
CASE   WHEN  (  TO_CHAR(:DT,'MM') = 01  AND SUBSTR(:CT,1,1) = 3 ) THEN 0 
WHEN :IMPRIME = 'S' THEN 0 
ELSE   
 (SUM( SALDOINICMES + DEBMES - CREDMES) ) * (CASE WHEN SUBSTR(:CT,1,1) = 3 THEN -1 ELSE 1 END )
END 
  FROM TCBSAL SAL
  WHERE CODEMP IN :CODEMP
  AND  SAL.CODCTACTB IN (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
  AND SAL.REFERENCIA = ADD_MONTHS(:DT,-1)   
) +
( SELECT 
 (SUM(CASE WHEN  LAN.TIPLANC = 'R' THEN VLRLANC WHEN LAN.TIPLANC= 'D' THEN   LAN.VLRLANC *-1   END )) * 
     (CASE WHEN SUBSTR(:CT,1,1) = 3 THEN 1 ELSE -1 END )
 FROM
  TCBLAN LAN  
WHERE 
LIBERADO = 'S'
AND LAN.CODEMP IN :CODEMP
AND LAN.CODCTACTB IN   (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTR(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
AND LAN.REFERENCIA= :DT
)AS  SALDOFINAL

FROM DUAL

]]></expression>
              <metadata>
                <field name="SALDOANT" label="SALDOANT" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
                <field name="CREDITO" label="CREDITO" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
                <field name="DEBITO" label="DEBITO" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
                <field name="SALDOFINAL" label="SALDOFINAL" type="F" visible="true" useFooter="false" mask="#.##0,00"/>
              </metadata>
              <value-expression><![CDATA[<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-p6l9{font-size:13px;font-family:Verdana, Geneva, sans-serif !important;;background-color:#000000;color:#ffffff;border-color:inherit;text-align:center}
.tg .tg-mnbw{font-size:13px;font-family:Verdana, Geneva, sans-serif !important;;background-color:#000000;color:#ffffff;border-color:inherit;text-align:center;vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-p6l9">   SALDO ANTERIOR   <br></th>
    <th class="tg-p6l9">   CRÉDITO   </th>
    <th class="tg-p6l9">   DÉBITO   </th>
    <th class="tg-p6l9">   SALDO FINAL   <br></th>
  </tr>
  <tr>
    <td class="tg-mnbw">$SALDOANT</td>
    <td class="tg-mnbw">$CREDITO</td>
    <td class="tg-mnbw">$DEBITO</td>
    <td class="tg-mnbw">$SALDOFINAL<br></td>
  </tr>
</table>]]></value-expression>
            </simple-value>
          </container>
          <container orientacao="V" tamanhoRelativo="861">
            <grid id="grd_5azv50" multiplaSelecao="S" useNewGrid="S">
              <args>
                <arg id="DT" type="date"/>
                <arg id="CT" type="text"/>
              </args>
              <expression type="sql" data-source="MGEDS"><![CDATA[
SELECT
    LAN.CODCTACTB,
   (SELECT CTACTB FROM TCBPLA P WHERE P.CODCTACTB = LAN.CODCTACTB ) CTACTB,
   NUMLANC, 
    NUMLOTE,
   NUMDOC,
   DTMOV,
   (CASE WHEN  LAN.TIPLANC = 'R' THEN VLRLANC END )  AS CREDITO,
 (CASE WHEN LAN.TIPLANC= 'D' THEN   LAN.VLRLANC    END )AS DEBITO,
 SUM ( (CASE WHEN  LAN.TIPLANC = 'R' THEN VLRLANC WHEN LAN.TIPLANC= 'D' THEN   LAN.VLRLANC *-1   END )  *   (CASE WHEN SUBSTRING(:CT,1,1) = 3 THEN 1 ELSE -1 END ) ) 
 OVER (   ORDER BY  DTMOV,  NUMLANC,   NUMLOTE,   NUMDOC  ROWS UNBOUNDED PRECEDING)AS TOT,
 CODCENCUS,
 (SELECT DESCRCENCUS FROM TSICUS CUS WHERE CUS.CODCENCUS = LAN.CODCENCUS)DESCRCENCUS,
  COMPLHIST ,
  ( SELECT DISTINCT NUNICO FROM TCBINT WHERE  CODEMP= LAN.CODEMP AND  NUMLANC=LAN.NUMLANC AND NUMLOTE=LAN.NUMLOTE   AND  REFERENCIA=LAN.REFERENCIA AND      SEQUENCIA = LAN.SEQUENCIA AND  TIPLANC =LAN.TIPLANC AND ORIGEM = 'F')     AS NUNICO
FROM
  TCBLAN LAN  
WHERE 
LIBERADO = 'S'
AND LAN.CODEMP IN :CODEMP
AND LAN.CODCTACTB IN   (SELECT CODCTACTB FROM TCBPLA PL WHERE  SUBSTRING(PL.CTACTB,1,LENGTH( :CT)) = :CT)   
AND LAN.REFERENCIA= :DT
 ORDER BY DTMOV,  NUMLANC,   NUMLOTE,   NUMDOC]]></expression>
              <metadata>
                <field name="CODCTACTB" label="Cta. Reduz" type="I" visible="true" useFooter="false"/>
                <field name="CTACTB" label="Conta" type="S" visible="true" useFooter="false"/>
                <field name="NUMLANC" label="Nro Lanc" type="I" visible="true" useFooter="false"/>
                <field name="NUMLOTE" label="Nro Lote" type="I" visible="true" useFooter="false"/>
                <field name="NUMDOC" label="Nro Doc" type="I" visible="true" useFooter="false"/>
                <field name="DTMOV" label="Dt. Mov" type="D" visible="true" useFooter="false"/>
                <field name="CREDITO" label="Crédito" type="F" visible="true" useFooter="SUM"/>
                <field name="DEBITO" label="Débito" type="F" visible="true" useFooter="SUM"/>
                <field name="TOT" label="Saldo" type="F" visible="true" useFooter="false"/>
                <field name="CODCENCUS" label="Centro Resultado" type="I" visible="true" useFooter="false"/>
                <field name="DESCRCENCUS" label="Descrição CR" type="S" visible="true" useFooter="false"/>
                <field name="COMPLHIST" label="COMPLHIST" type="S" visible="true" useFooter="false"/>
                <field name="NUNICO" label="NUNICO" type="I" visible="true" useFooter="false"/>
              </metadata>
              <on-click-launcher resource-id="br.com.sankhya.fin.cad.movimentacaoFinanceira">
                <NUFIN>$NUFIN</NUFIN>
              </on-click-launcher>
            </grid>
          </container>
        </container>
      </container>
    </container>
  </level>
</gadget>
